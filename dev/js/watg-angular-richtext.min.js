/*! watg-angular-richtext 2015-08-03 */
var watgRichtext=angular.module("watgRichtext",["ngRoute","ngSanitize","watgRichtext.templates"]).config(function($routeProvider){$routeProvider.when("/",{templateUrl:"app/views/test.html",controller:"testController"}).otherwise({redirectTo:"/"})});watgRichtext.controller("testController",function($scope){$scope.header="Richtext",$scope.item={Content:""},$scope.watgRichTextConfig={height:35,multiLine:!1,bootstrapCssPath:"../bower_components/bootstrap/dist/css/bootstrap.min.css",fontSizes:[{fontSizeName:"Huge",fontSize:7},{fontSizeName:"Big",fontSize:5},{fontSizeName:"Normal",fontSize:3},{fontSizeName:"Small",fontSize:1}],fontFamilies:[{fontName:"Arial"},{fontName:"Calibri"},{fontName:"Time New Roman"},{fontName:"Palatino Linotype"}],colors:[{colorName:"Black",colorValue:"000000"},{colorName:"Silver",colorValue:"C0C0C0"},{colorName:"Gray",colorValue:"808080"},{colorName:"White",colorValue:"FFFFFF"},{colorName:"Maroon",colorValue:"800000"},{colorName:"Red",colorValue:"FF0000"},{colorName:"Purple",colorValue:"800080"},{colorName:"Fuchsia",colorValue:"FF00FF"},{colorName:"Green",colorValue:"008000"},{colorName:"Lime",colorValue:"00ff00"},{colorName:"Olive",colorValue:"808000"},{colorName:"Yellow",colorValue:"ffff00"},{colorName:"Navy",colorValue:"000080"},{colorName:"Blue",colorValue:"0000FF"},{colorName:"Teal",colorValue:"008080"},{colorName:"Aqua",colorValue:"00ffff"}],showVariablesSelector:!1,showFontSelector:!1,showFontSizeSelector:!1,showColorSelector:!1,showBold:!1,showItalic:!1,showStrikeThrough:!1,showUnderline:!1,showUnorderedList:!1,showOrderedList:!1,showReduceIndent:!1,showIndent:!1,showLeftAlign:!1,showCenterAlign:!1,showRightAlign:!1,showJustify:!1,showUndo:!1,showRedo:!1,showInsertLink:!1,showRemoveLink:!1,showSourceCode:!1}}),watgRichtext.directive("watgRichtextEditor",function(){return{restrict:"E",templateUrl:"app/templates/watgRichtextEditorTemplate.html",scope:{richText:"=richText",config:"="},link:function(scope,element){var editor,editorDoc,editorHead,editorBody,watchCounter=0,defaultHeight=300,defaultBootstrapCssPath="public/css/vendor.min.css",singleLineMaxLength=150;scope.menuEnabled=!1,scope.showSourceEditor=!1,scope.richTextSource=scope.richText,scope.$watch("richText",function(){console.log("rich text changed"),scope.richText&&0===watchCounter&&(editorDoc.body.innerHTML=scope.richText,scope.richTextSource=scope.richText,watchCounter++),scope.richText?scope.menuEnabled=!0:scope.menuEnabled=!1}),scope.$watch("richTextSource",function(){console.log("rich text source changed"),scope.richText=scope.richTextSource,editorDoc.body.innerHTML=scope.richTextSource}),scope.$watch("config.variables",function(){}),scope.$watch("config.fontFamilies",function(){}),scope.$watch("config.fontSizes",function(){}),scope.$watch("config.colors",function(){}),void 0===scope.config.fontFamilies&&(scope.config.fontFamilies=[{fontName:"Arial"},{fontName:"Calibri"},{fontName:"Time New Roman"},{fontName:"Palatino Linotype"}]),void 0==scope.config.fontSizes&&(scope.config.fontSizes=[{fontSizeName:"Huge",fontSize:7},{fontSizeName:"Big",fontSize:5},{fontSizeName:"Normal",fontSize:3},{fontSizeName:"Small",fontSize:1}]),void 0==scope.config.colors&&(scope.config.colors=[{colorName:"Black",colorValue:"000000"},{colorName:"Silver",colorValue:"C0C0C0"},{colorName:"Gray",colorValue:"808080"},{colorName:"White",colorValue:"FFFFFF"},{colorName:"Maroon",colorValue:"800000"},{colorName:"Red",colorValue:"FF0000"},{colorName:"Purple",colorValue:"800080"},{colorName:"Fuchsia",colorValue:"FF00FF"},{colorName:"Green",colorValue:"008000"},{colorName:"Lime",colorValue:"00ff00"},{colorName:"Olive",colorValue:"808000"},{colorName:"Yellow",colorValue:"ffff00"},{colorName:"Navy",colorValue:"000080"},{colorName:"Blue",colorValue:"0000FF"},{colorName:"Teal",colorValue:"008080"},{colorName:"Aqua",colorValue:"00ffff"}]),scope.initialize=function(){editor=element.find("iframe")[0],editor?(editorDoc=editor.contentDocument?editor.contentDocument:editor.contentWindow.document,scope.config.bootstrapCssPath||(scope.config.bootstrapCssPath=defaultBootstrapCssPath),editorHead=editorDoc.head,null!=editorHead&&(editorHead.innerHTML="<link href='"+scope.config.bootstrapCssPath+"' rel='stylesheet'/>"),editorBody=editorDoc.body,scope.config.height||(scope.config.height=defaultHeight),$(editor).css("height",scope.config.height),$("#richTextSource").css("height",scope.config.height),scope.config.multiLine===!1&&($(editor).attr("maxLength","10"),$(editorBody).attr("maxLength","10")),"spellcheck"in editorBody&&(editorBody.spellcheck=!1),"contentEditable"in editorBody?editorBody.contentEditable=!0:"designMode"in editorDoc&&(editorDoc.designMode="on"),scope.richText&&(editorDoc.body.innerHTML=scope.richText),$(editor.contentWindow.document).keydown(function(e){console.log(e),scope.config.multiLine===!1&&(13===e.keyCode&&e.preventDefault(),scope.richText.length>singleLineMaxLength&&8!==e.keyCode&&35!==e.keyCode&&36!==e.keyCode&&46!==e.keyCode&&e.preventDefault())}),$(editor.contentWindow.document).keyup(function(){scope.update()}),$(editor.contentWindow.document).blur(function(){scope.update()})):console.error("Rich-text editor not found")},scope.update=function(){try{scope.richText=editorDoc.body.innerHTML,scope.$apply()}catch(e){}},scope.applyRichText=function(action,details){try{console.log("Action "+action+" Details "+details),"createLink"===action&&-1===details.indexOf("http://")&&(details="http://"+details),editorDoc.execCommand(action,!1,details),scope.update()}catch(e){}},scope.initialize()}}});